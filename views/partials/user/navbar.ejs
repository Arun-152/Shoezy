<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
<link rel="stylesheet" href="/css/navbar.css">

<body>
  <% if (user) { %>
  <header class="navbar-wrapper">
    <nav class="navbar">
      <div class="nav-left">
        <div class="hamburger-menu">
          <i class="fas fa-bars"></i>
        </div>
        <div class="logo">
          <h1>Shoezy</h1>
        </div>
      </div>
      <div class="nav-content">
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="/shop">Shop</a></li>
          <li><a href="/contact">Contact</a></li>
          <li><a href="/about">About</a></li>
        </ul>
      </div>
      <div class="nav-right">
        <div class="nav-icons">
          <span class="nav-icon wishlist-icon">
            <a href="/wishlist">
              <i class="fas fa-heart"></i>
              <span class="wishlist-count" id="wishlistCount">
                <%= typeof wishlistCount !=='undefined' ? wishlistCount : 0 %>
              </span>
            </a>
          </span>
          <span class="nav-icon cart-icon">
            <a href="/cart">
              <i class="fas fa-shopping-cart"></i>
              <span class="cart-count" id="cartCount">
                <%= typeof cartCount !=='undefined' ? cartCount : 0 %>
              </span>
            </a>
          </span>
          <span class="nav-icon profile-icon">
            <i class="fas fa-user"></i>
            <span class="profile-name"><%= user.fullname %></span>
            <div class="dropdown-menu">
              <a onclick="window.location.href = '/profile'">My Account</a>
              <a onclick="window.location.href = '/order'">My Orders</a>
              <a onclick="logout()" style="color: #dc3545;">Logout</a>
            </div>
          </span>
        </div>
      </div>
    </nav>
  </header>
  <% } else { %>
  <header class="navbar-wrapper">
    <nav class="navbar">
      <div class="nav-left">
        <div class="hamburger-menu">
          <i class="fas fa-bars"></i>
        </div>
        <div class="logo">
          <h1>Shoezy</h1>
        </div>
      </div>
      <div class="nav-content">
        <ul class="nav-links">
          <li><a href="/">Home</a></li>
          <li><a href="/shop">Shop</a></li>
          <li><a href="/#">Contact</a></li>
          <li><a href="/#">About</a></li>
          <li class="nav-icon login-icon">
            <a href="/login"><i class="fas fa-sign-in-alt"></i> Login</a>
            <div class="dropdown-menu">
              <a onclick="window.location.href='/login'">Login</a>
              <a onclick="signup()">Register</a>
            </div>
          </li>
        </ul>
      </div>
      <div class="nav-icons"></div>
    </nav>
  </header>
  <% } %>

        <script>
          function logout() {
            window.location.href = '/logout';
          }

          function signup() {
            window.location.href = '/signup';
          }

          document.addEventListener('DOMContentLoaded', () => {
            const icons = document.querySelectorAll('.login-icon:not(.mobile-only), .profile-icon');
            icons.forEach(icon => {
              icon.addEventListener('click', (e) => {
                e.preventDefault();
                const dropdown = icon.querySelector('.dropdown-menu');
                document.querySelectorAll('.dropdown-menu').forEach(other => {
                  if (other !== dropdown) other.classList.remove('show');
                });
                dropdown.classList.toggle('show');
              });
            });

            const hamburger = document.querySelector('.hamburger-menu');
            const navContent = document.querySelector('.nav-content');
            hamburger.addEventListener('click', () => {
              navContent.classList.toggle('active');
              hamburger.classList.toggle('active');
            });

            document.addEventListener('click', (e) => {
              if (!e.target.closest('.login-icon') && !e.target.closest('.profile-icon')) {
                document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
                  dropdown.classList.remove('show');
                });
              }
              if (!e.target.closest('.navbar') && navContent.classList.contains('active')) {
                navContent.classList.remove('active');
                hamburger.classList.remove('active');
              }
            });
          });
        </script>
</body>

</html>