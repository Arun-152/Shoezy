<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shoezy - Premium Sneakers</title>
    <link rel="stylesheet" href="css/homePage.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
</head>


<body>
    <style>
        .featured-categories {
            width: 100%;
            margin: 0;
            padding: 0;
        }

        .air-jordan-banner {
            width: 100%;
            overflow: hidden;
        }

        .air-jordan-banner img {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
        }
    </style>

    <!-- Header -->
    <%-include('../partials/user/navbar')%>

        <!-- Enhanced Hero Section -->
        <section class="hero-section">
            <img src="/images/Move+ Desktop Banner.jpg" alt="Featured Sneaker" class="hero-image">
        </section>


        <!-- Featured Categories - FULL WIDTH AIR JORDAN SECTION -->
        <section class="featured-categories">
            <div class="air-jordan-banner">
                <a href="/product/68eb586d6d69eea1b10888b9">
                    <img src="/images/1920x800_skyhand_OG.webp" alt="Air Jordan">
                </a>
            </div>
        </section>


        <!-- New Arrivals Section -->
        <section class="products-section new-arrivals">
            <div class="container">
                <div class="section-header">
                    <div class="section-title">
                        <h2>New Arrivals</h2>
                        <p>Fresh styles just dropped</p>
                    </div>
                    <div class="section-controls">
                        <a href="/shop" class="view-all-btn">View All</a>
                    </div>
                </div>

                <div class="products-grid" id="new-arrivals-grid">
                    <% if (products && products.length> 0) { %>
                        <% products.slice(0, 4).forEach(product=> { %>
                            <div class="product-card modern"
                                onclick="<%= typeof user !== 'undefined' && user ? `window.location.href='/product/${product._id}'` : 'redirectToLogin()' %>"
                                style="cursor: pointer;">
                                <div class="product-image-container">
                                    <div class="product-image">
                                        <% if (product.images && product.images.length> 0) { %>
                                            <img src="<%= product.images[0] %>" alt="<%= product.productName %>">
                                            <% } else { %>
                                                <img src="https://via.placeholder.com/280x280/f8f9fa/dee2e6?text=No+Image"
                                                    alt="<%= product.productName %>">
                                                <% } %>
                                    </div>

                                    <!-- Badges -->
                                    <% if (product.bestOffer && product.bestOffer> 0) { %>
                                        <div class="offer-badge">
                                            <%= product.bestOffer %>% OFF
                                        </div>
                                        <% } %>

                                            <div
                                                class="stock-badge <%= product.status === 'Available' ? 'in-stock' : 'out-of-stock' %>">
                                                <%= product.status==='Available' ? 'Available' : 'Out of Stock' %>
                                            </div>

                                            <!-- Wishlist -->
                                            <div class="wishlist-btn"
                                                onclick="event.stopPropagation(); toggleWishlist('<%= product._id %>', this)">
                                                <% if (wishlistItems && wishlistItems.includes(product._id.toString()))
                                                    { %>
                                                    <i class="fas fa-heart" style="color: #ff4757;"></i>
                                                    <% } else { %>
                                                        <i class="far fa-heart"></i>
                                                        <% } %>
                                            </div>

                                            <!-- Quick Actions -->
                                            <div class="quick-actions">
                                                <% const totalStockNew=product.variants.reduce((sum, v)=> sum +
                                                    v.variantQuantity, 0);
                                                    %>
                                                    <% if (totalStockNew> 0) { %>
                                                        <button class="quick-action-btn"
                                                            onclick="event.stopPropagation(); addToCart('<%= product._id %>')"
                                                            title="Add to Cart">
                                                            <i class="fas fa-shopping-cart"></i>
                                                        </button>
                                                        <% } %>
                                                            <% if (typeof user !=='undefined' && user) { %>
                                                                <button class="quick-action-btn"
                                                                    onclick="event.stopPropagation(); window.location.href='/product/<%= product._id %>'"
                                                                    title="Quick View">
                                                                    <i class="fas fa-eye"></i>
                                                                </button>
                                                                <% } %>
                                            </div>
                                </div>

                                <div class="product-info">
                                    <h3 class="product-name">
                                        <%= product.productName %>
                                    </h3>
                                    <p class="product-category">
                                        <%= product.category ? product.category.name : 'Uncategorized' %>
                                    </p>




                                    <div class="product-price">
                                        <% if (product.variants && product.variants.length> 0) { %>
                                            <% const sortedVariants=[...product.variants].sort((a, b)=> Number(a.size) -
                                                Number(b.size));
                                                const firstAvailableVariant = sortedVariants.find(v => v.variantQuantity
                                                > 0);
                                                const variantToShow = firstAvailableVariant || sortedVariants[0];

                                                if (variantToShow) {
                                                const salePrice = variantToShow.salePrice;
                                                const originalPrice = variantToShow.regularPrice;
                                                const hasDiscount = salePrice < originalPrice; %>
                                                    <span class="current-price">₹<%= salePrice.toLocaleString('en-IN')
                                                            %></span>
                                                    <% if (hasDiscount) { %>
                                                        <span class="original-price"
                                                            style="text-decoration: line-through; font-weight: 400; font-size: larger; color: #db2525; margin-left: 5px;">₹
                                                            <%= originalPrice.toLocaleString('en-IN') %>
                                                        </span>
                                                        <% } %>
                                                            <% } else { %>
                                                                <span class="current-price">Price not available</span>
                                                                <% } %>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                            <% }) %>
                                <% } %>
                </div>
            </div>
        </section>

        <!-- Trending Now Section - SORTED BY HIGHEST OFFER/DISCOUNT -->
        <section class="products-section trending">
            <div class="container">
                <div class="section-header">
                    <div class="section-title">
                        <h2>Trending Now</h2>
                        <p>Most popular this week - Highest discounts first</p>
                    </div>
                    <div class="section-controls">
                        <a href="/shop" class="view-all-btn">View All</a>
                    </div>
                </div>

                <div class="products-grid" id="trending-grid">
                    <% if (products && products.length> 0) { %>
                        <% // Sort products by highest offer/discount first const
                            sortedByOffer=products.slice().sort((a, b)=> {
                            const getOffer = (product) => {
                            return product.bestOffer || 0;
                            };
                            return getOffer(b) - getOffer(a);
                            });
                            %>
                            <% sortedByOffer.slice(0, 4).forEach(product=> { %>
                                <div class="product-card modern"
                                    onclick="<%= typeof user !== 'undefined' && user ? `window.location.href='/product/${product._id}'` : 'redirectToLogin()' %>"
                                    style="cursor: pointer;">
                                    <!-- Same product card structure as New Arrivals -->
                                    <div class="product-image-container">
                                        <div class="product-image">
                                            <% if (product.images && product.images.length> 0) { %>
                                                <img src="<%= product.images[0] %>" alt="<%= product.productName %>">
                                                <% } else { %>
                                                    <img src="https://via.placeholder.com/280x280/f8f9fa/dee2e6?text=No+Image"
                                                        alt="<%= product.productName %>">
                                                    <% } %>
                                        </div>

                                        <% if (product.bestOffer && product.bestOffer> 0) { %>
                                            <div class="offer-badge">
                                                <%= product.bestOffer %>% OFF
                                            </div>
                                            <% } %>

                                                <div
                                                    class="stock-badge <%= product.status === 'Available' ? 'in-stock' : 'out-of-stock' %>">
                                                    <%= product.status==='Available' ? 'Available' : 'Out of Stock' %>
                                                </div>

                                                <div class="wishlist-btn"
                                                    onclick="event.stopPropagation(); toggleWishlist('<%= product._id %>', this)">
                                                    <% if (wishlistItems &&
                                                        wishlistItems.includes(product._id.toString())) { %>
                                                        <i class="fas fa-heart" style="color: #ff4757;"></i>
                                                        <% } else { %>
                                                            <i class="far fa-heart"></i>
                                                            <% } %>
                                                </div>

                                                <div class="quick-actions">
                                                    <% const totalStockTrending=product.variants.reduce((sum, v)=> sum +
                                                        v.variantQuantity, 0);
                                                        %>
                                                        <% if (totalStockTrending> 0) { %>
                                                            <button class="quick-action-btn"
                                                                onclick="event.stopPropagation(); addToCart('<%= product._id %>')"
                                                                title="Add to Cart">
                                                                <i class="fas fa-shopping-cart"></i>
                                                            </button>
                                                            <% } %>
                                                                <% if (typeof user !=='undefined' && user) { %>
                                                                    <button class="quick-action-btn"
                                                                        onclick="event.stopPropagation(); window.location.href='/product/<%= product._id %>'"
                                                                        title="Quick View">
                                                                        <i class="fas fa-eye"></i>
                                                                    </button>
                                                                    <% } %>
                                                </div>
                                    </div>

                                    <div class="product-info">
                                        <h3 class="product-name">
                                            <%= product.productName %>
                                        </h3>
                                        <p class="product-category">
                                            <%= product.category ? product.category.name : 'Uncategorized' %>
                                        </p>




                                        <div class="product-price">
                                            <% if (product.variants && product.variants.length> 0) { %>
                                                <% const sortedVariants=[...product.variants].sort((a, b)=>
                                                    Number(a.size) - Number(b.size));
                                                    const firstAvailableVariant = sortedVariants.find(v =>
                                                    v.variantQuantity > 0);
                                                    const variantToShow = firstAvailableVariant || sortedVariants[0];

                                                    if (variantToShow) {
                                                    const salePrice = variantToShow.salePrice;
                                                    const originalPrice = variantToShow.regularPrice;
                                                    const hasDiscount = salePrice < originalPrice; %>
                                                        <span class="current-price">₹<%=
                                                                salePrice.toLocaleString('en-IN') %></span>
                                                        <% if (hasDiscount) { %>
                                                            <span class="original-price"
                                                                style="text-decoration: line-through; font-weight: 400; font-size: larger; color: #db2525; margin-left: 5px;">₹
                                                                <%= originalPrice.toLocaleString('en-IN') %>
                                                            </span>
                                                            <% } %>
                                                                <% } else { %>
                                                                    <span class="current-price">Price not
                                                                        available</span>
                                                                    <% } %>
                                        </div>
                                        <% } %>
                                    </div>
                                </div>
                                <% }) %>
                                    <% } %>
                </div>
            </div>
        </section>

        <!-- Premium Collections Section - WHITE BACKGROUND & HIGHEST PRICED PRODUCTS -->
        <section class="products-section premium-white">
            <div class="container">
                <div class="section-header">
                    <div class="section-title">
                        <h2>Premium Collections</h2>
                        <p>Exclusive luxury footwear - Highest priced collection</p>
                    </div>
                    <div class="section-controls">
                        <a href="/shop" class="view-all-btn">View All</a>
                    </div>
                </div>

                <div class="products-grid" id="premium-grid">
                    <% if (products && products.length> 0) { %>
                        <% // Sort products by highest price (using maximum sale price from variants) const
                            sortedProducts=products.slice().sort((a, b)=> {
                            const getMaxPrice = (product) => {
                            if (product.variants && product.variants.length > 0) {
                            const prices = product.variants.map(v => v.salePrice);
                            return Math.max(...prices);
                            }
                            return 0;
                            };
                            return getMaxPrice(b) - getMaxPrice(a);
                            });
                            %>
                            <% sortedProducts.slice(0, 4).forEach(product=> { %>
                                <div class="product-card modern premium-card"
                                    onclick="<%= typeof user !== 'undefined' && user ? `window.location.href='/product/${product._id}'` : 'redirectToLogin()' %>"
                                    style="cursor: pointer;">
                                    <div class="product-image-container">
                                        <div class="product-image">
                                            <% if (product.images && product.images.length> 0) { %>
                                                <img src="<%= product.images[0] %>" alt="<%= product.productName %>">
                                                <% } else { %>
                                                    <img src="https://via.placeholder.com/280x280/f8f9fa/dee2e6?text=No+Image"
                                                        alt="<%= product.productName %>">
                                                    <% } %>
                                        </div>

                                        <div class="premium-badge">PREMIUM</div>

                                        <% if (product.bestOffer && product.bestOffer> 0) { %>
                                            <div class="offer-badge">
                                                <%= product.bestOffer %>% OFF
                                            </div>
                                            <% } %>

                                                <div
                                                    class="stock-badge <%= product.status === 'Available' ? 'in-stock' : 'out-of-stock' %>">
                                                    <%= product.status==='Available' ? 'Available' : 'Out of Stock' %>
                                                </div>

                                                <div class="wishlist-btn"
                                                    onclick="event.stopPropagation(); toggleWishlist('<%= product._id %>', this)">
                                                    <% if (wishlistItems &&
                                                        wishlistItems.includes(product._id.toString())) { %>
                                                        <i class="fas fa-heart" style="color: #ff4757;"></i>
                                                        <% } else { %>
                                                            <i class="far fa-heart"></i>
                                                            <% } %>
                                                </div>

                                                <div class="quick-actions">
                                                    <% const totalStockPremium=product.variants.reduce((sum, v)=> sum +
                                                        v.variantQuantity, 0);
                                                        %>
                                                        <% if (totalStockPremium> 0) { %>
                                                            <button class="quick-action-btn"
                                                                onclick="event.stopPropagation(); addToCart('<%= product._id %>')"
                                                                title="Add to Cart">
                                                                <i class="fas fa-shopping-cart"></i>
                                                            </button>
                                                            <% } %>
                                                                <% if (typeof user !=='undefined' && user) { %>
                                                                    <button class="quick-action-btn"
                                                                        onclick="event.stopPropagation(); window.location.href='/product/<%= product._id %>'"
                                                                        title="Quick View">
                                                                        <i class="fas fa-eye"></i>
                                                                    </button>
                                                                    <% } %>
                                                </div>
                                    </div>

                                    <div class="product-info">
                                        <h3 class="product-name">
                                            <%= product.productName %>
                                        </h3>
                                        <p class="product-category">
                                            <%= product.category ? product.category.name : 'Uncategorized' %>
                                        </p>



                                        <div class="product-price">
                                            <% if (product.variants && product.variants.length> 0) { %>
                                                <% const sortedVariants=[...product.variants].sort((a, b)=>
                                                    Number(a.size) - Number(b.size));
                                                    const firstAvailableVariant = sortedVariants.find(v =>
                                                    v.variantQuantity > 0);
                                                    const variantToShow = firstAvailableVariant || sortedVariants[0];

                                                    if (variantToShow) {
                                                    const salePrice = variantToShow.salePrice;
                                                    const originalPrice = variantToShow.regularPrice;
                                                    const hasDiscount = salePrice < originalPrice; %>
                                                        <span class="current-price">₹<%=
                                                                salePrice.toLocaleString('en-IN') %></span>
                                                        <% if (hasDiscount) { %>
                                                            <span class="original-price"
                                                                style="text-decoration: line-through; font-weight: 400; font-size: larger; color: #db2525; margin-left: 5px;">₹
                                                                <%= originalPrice.toLocaleString('en-IN') %>
                                                            </span>
                                                            <% } %>
                                                                <% } else { %>
                                                                    <span class="current-price">Price not
                                                                        available</span>
                                                                    <% } %>
                                        </div>
                                        <% } %>
                                    </div>
                                </div>
                                <% }) %>
                                    <% } %>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="testimonials">
            <div class="container">
                <div class="section-header centered">
                    <h2>What Our Customers Say</h2>
                    <p>Real reviews from real sneaker enthusiasts</p>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <%-include("../partials/user/userfooter")%>

            <script>
                // Enhanced Add to Cart functionality
                async function addToCart(productId, size = null) {
                    try {
                        const response = await fetch('/cart/add', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                "Accept": "application/json"
                            },
                            body: JSON.stringify({
                                productId: productId,
                                size: size,
                                quantity: 1
                            })
                        });

                        const data = await response.json();

                        if (data.success) {
                            updateCartCount(data.cartCount)
                            showNotification('Product added to cart successfully!');
                        } else {
                            if (data.message === "Please login to continue") {
                                window.location.href = '/login'
                            }
                            showNotification(data.message || 'Error adding product to cart');
                        }
                    } catch (error) {
                        console.error('Error adding to cart:', error);
                        showNotification('Error adding product to cart. Please try again.');
                    }
                }

                // Update cart count in navbar
                function updateCartCount(change) {
                    const cartCountElem = document.getElementById('cartCount');
                    if (cartCountElem) {
                        const currentCount = parseInt(cartCountElem.textContent) || 0;
                        const newCount = Math.max(0, change);
                        cartCountElem.textContent = newCount;

                        // Add animation to cart icon
                        const cartIcon = cartCountElem.closest('.cart-icon');
                        if (cartIcon) {
                            cartIcon.style.animation = 'cartBounce 0.5s ease';
                            setTimeout(() => {
                                cartIcon.style.animation = '';
                            }, 500);
                        }
                    }
                }

                // Enhanced wishlist functionality
                async function toggleWishlist(productId, element) {
                    const heartIcon = element.querySelector('i');
                    const isInWishlist = heartIcon.classList.contains('fas');

                    try {
                        const response = await fetch('/wishlist/toggle', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                "Accept": "application/json"
                            },
                            body: JSON.stringify({ productId: productId })
                        });

                        const data = await response.json();

                        if (data.success) {
                            if (data.action === 'added') {
                                heartIcon.classList.remove('far');
                                heartIcon.classList.add('fas');
                                heartIcon.style.color = '#ff4757';
                                updateWishlistCount(1)
                                showNotification('Added to wishlist!');
                            } else if (data.action === 'removed') {
                                heartIcon.classList.remove('fas');
                                heartIcon.classList.add('far');
                                heartIcon.style.color = '';
                                updateWishlistCount(-1)
                                showNotification('Removed from wishlist!');
                            }
                        } else {
                            if (data.message === "Please login to continue") {
                                window.location.href = '/login'
                            }
                            showNotification(data.message || 'Error updating wishlist');
                        }
                    } catch (error) {
                        console.error('Error toggling wishlist:', error.message);
                        showNotification('Error updating wishlist. Please try again.');
                    }
                }

                function updateWishlistCount(change) {
                    const wishlistCountElem = document.getElementById('wishlistCount');
                    if (wishlistCountElem) {
                        const currentCount = parseInt(wishlistCountElem.textContent) || 0;
                        const newCount = Math.max(0, currentCount + change);
                        wishlistCountElem.textContent = newCount;
                    }
                }

                function showNotification(message) {
                    const notification = document.createElement('div');
                    notification.className = 'notification';
                    notification.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            `;
                    document.body.appendChild(notification);

                    setTimeout(() => {
                        notification.style.animation = 'slideOut 0.3s ease forwards';
                        setTimeout(() => {
                            notification.remove();
                        }, 300);
                    }, 2700);
                }

                function redirectToLogin() {
                    window.location.href = '/login';
                    return false;
                }

                // Enhanced functionality for new design
                document.addEventListener('DOMContentLoaded', function () {
                    // All shop buttons functionality
                    const shopBtns = document.querySelectorAll('.shop-btn');
                    shopBtns.forEach(btn => {
                        btn.addEventListener('click', function () {
                    <% if (typeof user !== 'undefined' && user) { %>
                                window.location.href = '/shop';
                    <% } else { %>
                                redirectToLogin();
                    <% } %>
                });
                    });

                    // Color selector functionality
                    const colorDots = document.querySelectorAll('.color-dot');
                    colorDots.forEach(dot => {
                        dot.addEventListener('click', function () {
                            colorDots.forEach(d => d.classList.remove('active'));
                            this.classList.add('active');
                        });
                    });
                });
            </script>
</body>

</html>