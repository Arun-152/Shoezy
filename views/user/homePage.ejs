<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shoezy - Premium Sneakers</title>
    <link rel="stylesheet" href="css/homePage.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
</head>


<body>
    <style>
        .header-section {
            text-align: center;
            margin-bottom: 60px;
            padding-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .header-section h1 {
            font-size: 48px;
            color: #ffffff;
            margin-bottom: 15px;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .header-section .subtitle {
            font-size: 20px;
            color: #ffffff;
            font-weight: 300;
        }

        .trust-badges {
            display: flex;
            justify-content: center;
            gap: 60px;
            margin-top: 60px;
            padding: 40px;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            flex-wrap: wrap;
            max-width: 100%;
        }

        .badge-item {
            text-align: center;
            min-width: 120px;
        }

        .badge-item h3 {
            font-size: 42px;
            color: #ffffff;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .badge-item p {
            font-size: 15px;
            color: #ffffff;
            font-weight: 500;
        }

        .featured-categories {
            width: 100%;
            margin: 0;
            padding: 0;
            max-width: 100%;
            overflow: hidden;
        }

        .air-jordan-banner {
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }

        .air-jordan-banner img {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
            max-width: 100%;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .header-section h1 {
                font-size: 32px;
            }

            .header-section .subtitle {
                font-size: 16px;
            }

            .trust-badges {
                gap: 30px;
                padding: 30px 20px;
            }

            .badge-item {
                min-width: 80px;
            }

            .badge-item h3 {
                font-size: 28px;
            }

            .badge-item p {
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .header-section {
                margin-bottom: 40px;
                padding-bottom: 20px;
            }

            .header-section h1 {
                font-size: 24px;
                letter-spacing: 0;
            }

            .header-section .subtitle {
                font-size: 14px;
            }

            .trust-badges {
                gap: 20px;
                padding: 20px 16px;
                margin-top: 40px;
            }

            .badge-item {
                min-width: 70px;
                flex: 0 0 calc(50% - 10px);
            }

            .badge-item h3 {
                font-size: 24px;
            }

            .badge-item p {
                font-size: 11px;
            }
        }

        /* Size Selection Modal */
        .size-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10001;
            transition: opacity 0.3s ease;
        }

        .size-modal {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 350px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            position: relative;
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .size-modal-overlay.show .size-modal {
            transform: scale(1);
            opacity: 1;
        }

        .size-modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.8rem;
            color: #9ca3af;
            cursor: pointer;
            line-height: 1;
            transition: color 0.2s ease;
        }

        .size-modal-close:hover {
            color: #374151;
        }

        .size-modal h4 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
            color: #1f2937;
            font-weight: 600;
        }

        .size-modal .product-name {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 1.5rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .size-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.8rem;
        }

        .size-option {
            padding: 0.6rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .size-option .size-label {
            font-weight: 600;
            font-size: 1rem;
            color: #374151;
            display: block;
        }

        .size-option .size-price {
            font-size: 0.8rem;
            color: #6b7280;
            display: block;
        }

        .size-option:hover {
            border-color: #10b981;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
    </style>


    <!-- Header -->
    <%-include('../partials/user/navbar')%>

        <!-- Enhanced Hero Section -->
        <section class="hero-section">
            <img src="/images/Move+ Desktop Banner.jpg" alt="Featured Sneaker" class="hero-image">
        </section>


        <!-- Featured Categories - FULL WIDTH AIR JORDAN SECTION -->
        <section class="featured-categories">
            <div class="air-jordan-banner">
                <a href="/product/68eb586d6d69eea1b10888b9">
                    <img src="/images/1920x800_skyhand_OG.webp" alt="Air Jordan">
                </a>
            </div>
        </section>


        <!-- New Arrivals Section -->
        <section class="products-section new-arrivals">
            <div class="container">
                <div class="section-header">
                    <div class="section-title">
                        <h2>New Arrivals</h2>
                        <p>Fresh styles just dropped</p>
                    </div>
                    <div class="section-controls">
                        <a href="/shop" class="view-all-btn">View All</a>
                    </div>
                </div>

                <div class="products-grid" id="new-arrivals-grid">
                    <% const newArrivals=products.slice(0, 4); %>
                        <% if (newArrivals && newArrivals.length> 0) { %>
                            <% newArrivals.forEach(product=> { %>
                                <div class="product-card modern"
                                    onclick="<%= typeof user !== 'undefined' && user ? `window.location.href='/product/${product._id}'` : 'redirectToLogin()' %>"
                                    data-variants='<%- JSON.stringify(product.variants) %>'
                                    style="cursor: pointer;">
                                    <div class="product-image-container">
                                        <div class="product-image">
                                            <% if (product.images && product.images.length> 0) { %>
                                                <img src="<%= product.images[0] %>" alt="<%= product.productName %>">
                                                <% } else { %>
                                                    <img src="https://via.placeholder.com/280x280/f8f9fa/dee2e6?text=No+Image"
                                                        alt="<%= product.productName %>">
                                                    <% } %>
                                        </div>

                                        <!-- Badges -->
                                        <% if (product.bestOffer && product.bestOffer> 0) { %>
                                            <div class="offer-badge">
                                                <%= product.bestOffer %>% OFF
                                            </div>
                                            <% } %>

                                                <div
                                                    class="stock-badge <%= product.status === 'Available' ? 'in-stock' : 'out-of-stock' %>">
                                                    <%= product.status==='Available' ? 'Available' : 'Out of Stock' %>
                                                </div>

                                                <!-- Wishlist -->
                                                <div class="wishlist-btn"
                                                    onclick="event.stopPropagation(); toggleWishlist('<%= product._id %>', this)">
                                                    <% if (wishlistItems &&
                                                        wishlistItems.includes(product._id.toString())) { %>
                                                        <i class="fas fa-heart" style="color: #ff4757;"></i>
                                                        <% } else { %>
                                                            <i class="far fa-heart"></i>
                                                            <% } %>
                                                </div>

                                                <!-- Quick Actions -->
                                                <div class="quick-actions">
                                                    <% const totalStockNew=product.variants.reduce((sum, v)=> sum +
                                                        v.variantQuantity, 0);
                                                        %>
                                                        <% if (totalStockNew> 0) { %>
                                                            <button class="quick-action-btn"
                                                                onclick="event.stopPropagation(); openSizeModal(this, '<%= product._id %>')"
                                                                title="Add to Cart">
                                                                <i class="fas fa-shopping-cart"></i>
                                                            </button>
                                                            <% } %>
                                                                <% if (typeof user !=='undefined' && user) { %>
                                                                    <button class="quick-action-btn"
                                                                        onclick="event.stopPropagation(); window.location.href='/product/<%= product._id %>'"
                                                                        title="Quick View">
                                                                        <i class="fas fa-eye"></i>
                                                                    </button>
                                                                    <% } %>
                                                </div> -->
                                    </div>

                                    <div class="product-info">
                                        <h3 class="product-name">
                                            <%= product.productName %>
                                        </h3>
                                        <p class="product-category">
                                            <%= product.category ? product.category.name : 'Uncategorized' %>
                                        </p>




                                        <div class="product-price">
                                            <% if (product.variants && product.variants.length> 0) { %>
                                                <% const sortedVariants=[...product.variants].sort((a, b)=>
                                                    Number(a.size) -
                                                    Number(b.size));
                                                    const firstAvailableVariant = sortedVariants.find(v =>
                                                    v.variantQuantity
                                                    > 0);
                                                    const variantToShow = firstAvailableVariant || sortedVariants[0];

                                                    if (variantToShow) {
                                                    const salePrice = variantToShow.salePrice;
                                                    const originalPrice = variantToShow.regularPrice;
                                                    const hasDiscount = salePrice < originalPrice; %>
                                                        <span class="current-price">₹<%=
                                                                salePrice.toLocaleString('en-IN') %></span>
                                                        <% if (hasDiscount) { %>
                                                            <span class="original-price"
                                                                style="text-decoration: line-through; font-weight: 400; font-size: larger; color: #db2525; margin-left: 5px;">₹
                                                                <%= originalPrice.toLocaleString('en-IN') %>
                                                            </span>
                                                            <% } %>
                                                                <% } else { %>
                                                                    <span class="current-price">Price not
                                                                        available</span>
                                                                    <% } %>
                                        </div>
                                        <% } %>
                                    </div>
                                </div>
                                <% }) %>
                                    <% } %>
                </div>
            </div>
        </section>

        <!-- Trending Now Section - SORTED BY HIGHEST OFFER/DISCOUNT -->
        <section class="products-section trending">
            <div class="container">
                <div class="section-header">
                    <div class="section-title">
                        <h2>Trending Now</h2>
                        <p>Most popular this week - Highest discounts first</p>
                    </div>
                    <div class="section-controls">
                        <a href="/shop" class="view-all-btn">View All</a>
                    </div>
                </div>

                <div class="products-grid" id="trending-grid">
                    <% if (products && products.length> 0) { %>
                        <% const sortedByOffer=products.slice().sort((a, b)=> {
                            const getOffer = (product) => {
                            return product.bestOffer || 0;
                            };
                            return getOffer(b) - getOffer(a);
                            });
                            const trendingProducts = sortedByOffer.slice(0, 4); %>
                            <% if (trendingProducts.length> 0) { %>
                                <% trendingProducts.forEach(product=> { %>
                                    <div class="product-card modern"
                                        onclick="<%= typeof user !== 'undefined' && user ? `window.location.href='/product/${product._id}'` : 'redirectToLogin()' %>"
                                        data-variants='<%- JSON.stringify(product.variants) %>'
                                        style="cursor: pointer;">
                                        <!-- Same product card structure as New Arrivals -->
                                        <div class="product-image-container">
                                            <div class="product-image">
                                                <% if (product.images && product.images.length> 0) { %>
                                                    <img src="<%= product.images[0] %>"
                                                        alt="<%= product.productName %>">
                                                    <% } else { %>
                                                        <img src="https://via.placeholder.com/280x280/f8f9fa/dee2e6?text=No+Image"
                                                            alt="<%= product.productName %>">
                                                        <% } %>
                                            </div>

                                            <% if (product.bestOffer && product.bestOffer> 0) { %>
                                                <div class="offer-badge">
                                                    <%= product.bestOffer %>% OFF
                                                </div>
                                                <% } %>

                                                    <div
                                                        class="stock-badge <%= product.status === 'Available' ? 'in-stock' : 'out-of-stock' %>">
                                                        <%= product.status==='Available' ? 'Available' : 'Out of Stock'
                                                            %>
                                                    </div>

                                                    <div class="wishlist-btn"
                                                        onclick="event.stopPropagation(); toggleWishlist('<%= product._id %>', this)">
                                                        <% if (wishlistItems &&
                                                            wishlistItems.includes(product._id.toString())) { %>
                                                            <i class="fas fa-heart" style="color: #ff4757;"></i>
                                                            <% } else { %>
                                                                <i class="far fa-heart"></i>
                                                                <% } %>
                                                    </div>

                                                    <div class="quick-actions">
                                                        <% const totalStockTrending=product.variants.reduce((sum, v)=>
                                                            sum +
                                                            v.variantQuantity, 0);
                                                            %>
                                                            <% if (totalStockTrending> 0) { %>
                                                                <button class="quick-action-btn"
                                                                    onclick="event.stopPropagation(); openSizeModal(this, '<%= product._id %>')"
                                                                    title="Add to Cart">
                                                                    <i class="fas fa-shopping-cart"></i>
                                                                </button>
                                                                <% } %>
                                                                    <% if (typeof user !=='undefined' && user) { %>
                                                                        <button class="quick-action-btn"
                                                                            onclick="event.stopPropagation(); window.location.href='/product/<%= product._id %>'"
                                                                            title="Quick View">
                                                                            <i class="fas fa-eye"></i>
                                                                        </button>
                                                                        <% } %>
                                                    </div>
                                        </div>

                                        <div class="product-info">
                                            <h3 class="product-name">
                                                <%= product.productName %>
                                            </h3>
                                            <p class="product-category">
                                                <%= product.category ? product.category.name : 'Uncategorized' %>
                                            </p>




                                            <div class="product-price">
                                                <% if (product.variants && product.variants.length> 0) { %>
                                                    <% const sortedVariants=[...product.variants].sort((a, b)=>
                                                        Number(a.size) - Number(b.size));
                                                        const firstAvailableVariant = sortedVariants.find(v =>
                                                        v.variantQuantity > 0);
                                                        const variantToShow = firstAvailableVariant ||
                                                        sortedVariants[0];

                                                        if (variantToShow) {
                                                        const salePrice = variantToShow.salePrice;
                                                        const originalPrice = variantToShow.regularPrice;
                                                        const hasDiscount = salePrice < originalPrice; %>
                                                            <span class="current-price">₹<%=
                                                                    salePrice.toLocaleString('en-IN') %></span>
                                                            <% if (hasDiscount) { %>
                                                                <span class="original-price"
                                                                    style="text-decoration: line-through; font-weight: 400; font-size: larger; color: #db2525; margin-left: 5px;">₹
                                                                    <%= originalPrice.toLocaleString('en-IN') %>
                                                                </span>
                                                                <% } %>
                                                                    <% } else { %>
                                                                        <span class="current-price">Price not
                                                                            available</span>
                                                                        <% } %>
                                            </div>
                                            <% } %>
                                        </div>
                                    </div>
                                    <% }) %>
                                        <% } %>
                                            <% } %>
                </div>
            </div>
        </section>

        <!-- Premium Collections Section - WHITE BACKGROUND & HIGHEST PRICED PRODUCTS -->
        <section class="products-section premium-white">
            <div class="container">
                <div class="section-header">
                    <div class="section-title">
                        <h2>Premium Collections</h2>
                        <p>Exclusive luxury footwear - Highest priced collection</p>
                    </div>
                    <div class="section-controls">
                        <a href="/shop" class="view-all-btn">View All</a>
                    </div>
                </div>

                <div class="products-grid" id="premium-grid">
                    <% if (products && products.length> 0) { %>
                        <% const sortedByPrice=products.slice().sort((a, b)=> {
                            const getMaxPrice = (product) => {
                            if (product.variants && product.variants.length > 0) {
                            const prices = product.variants.map(v => v.salePrice);
                            return Math.max(...prices);
                            }
                            return 0;
                            };
                            return getMaxPrice(b) - getMaxPrice(a);
                            });
                            const premiumProducts = sortedByPrice.slice(0, 4); %>
                            <% if (premiumProducts.length> 0) { %>
                                <% premiumProducts.forEach(product=> { %>
                                    <div class="product-card modern premium-card"
                                        onclick="<%= typeof user !== 'undefined' && user ? `window.location.href='/product/${product._id}'` : 'redirectToLogin()' %>"
                                        data-variants='<%- JSON.stringify(product.variants) %>'
                                        style="cursor: pointer;">
                                        <div class="product-image-container">
                                            <div class="product-image">
                                                <% if (product.images && product.images.length> 0) { %>
                                                    <img src="<%= product.images[0] %>"
                                                        alt="<%= product.productName %>">
                                                    <% } else { %>
                                                        <img src="https://via.placeholder.com/280x280/f8f9fa/dee2e6?text=No+Image"
                                                            alt="<%= product.productName %>">
                                                        <% } %>
                                            </div>

                                            <div class="premium-badge">PREMIUM</div>

                                            <% if (product.bestOffer && product.bestOffer> 0) { %>
                                                <div class="offer-badge">
                                                    <%= product.bestOffer %>% OFF
                                                </div>
                                                <% } %>

                                                    <div
                                                        class="stock-badge <%= product.status === 'Available' ? 'in-stock' : 'out-of-stock' %>">
                                                        <%= product.status==='Available' ? 'Available' : 'Out of Stock'
                                                            %>
                                                    </div>

                                                    <div class="wishlist-btn"
                                                        onclick="event.stopPropagation(); toggleWishlist('<%= product._id %>', this)">
                                                        <% if (wishlistItems &&
                                                            wishlistItems.includes(product._id.toString())) { %>
                                                            <i class="fas fa-heart" style="color: #ff4757;"></i>
                                                            <% } else { %>
                                                                <i class="far fa-heart"></i>
                                                                <% } %>
                                                    </div>

                                                    <div class="quick-actions">
                                                        <% const totalStockPremium=product.variants.reduce((sum, v)=>
                                                            sum +
                                                            v.variantQuantity, 0);
                                                            %>
                                                            <% if (totalStockPremium> 0) { %>
                                                                <button class="quick-action-btn"
                                                                    onclick="event.stopPropagation(); openSizeModal(this, '<%= product._id %>')"
                                                                    title="Add to Cart">
                                                                    <i class="fas fa-shopping-cart"></i>
                                                                </button>
                                                                <% } %>
                                                                    <% if (typeof user !=='undefined' && user) { %>
                                                                        <button class="quick-action-btn"
                                                                            onclick="event.stopPropagation(); window.location.href='/product/<%= product._id %>'"
                                                                            title="Quick View">
                                                                            <i class="fas fa-eye"></i>
                                                                        </button>
                                                                        <% } %>
                                                    </div>
                                        </div>

                                        <div class="product-info">
                                            <h3 class="product-name">
                                                <%= product.productName %>
                                            </h3>
                                            <p class="product-category">
                                                <%= product.category ? product.category.name : 'Uncategorized' %>
                                            </p>



                                            <div class="product-price">
                                                <% if (product.variants && product.variants.length> 0) { %>
                                                    <% const sortedVariants=[...product.variants].sort((a, b)=>
                                                        Number(a.size) - Number(b.size));
                                                        const firstAvailableVariant = sortedVariants.find(v =>
                                                        v.variantQuantity > 0);
                                                        const variantToShow = firstAvailableVariant ||
                                                        sortedVariants[0];

                                                        if (variantToShow) {
                                                        const salePrice = variantToShow.salePrice;
                                                        const originalPrice = variantToShow.regularPrice;
                                                        const hasDiscount = salePrice < originalPrice; %>
                                                            <span class="current-price">₹<%=
                                                                    salePrice.toLocaleString('en-IN') %></span>
                                                            <% if (hasDiscount) { %>
                                                                <span class="original-price"
                                                                    style="text-decoration: line-through; font-weight: 400; font-size: larger; color: #db2525; margin-left: 5px;">₹
                                                                    <%= originalPrice.toLocaleString('en-IN') %>
                                                                </span>
                                                                <% } %>
                                                                    <% } else { %>
                                                                        <span class="current-price">Price not
                                                                            available</span>
                                                                        <% } %>
                                            </div>
                                            <% } %>
                                        </div>
                                    </div>
                                    <% }) %>
                                        <% } %>
                                            <% } %>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="testimonials">
            <div class="container">
                <div class="header-section">
                    <h1>Customer Reviews</h1>
                    <p class="subtitle">Trusted by thousands of men worldwide</p>
                </div>
                <div class="trust-badges">
                    <div class="badge-item">
                        <h3>50K+</h3>
                        <p>Satisfied Customers</p>
                    </div>
                    <div class="badge-item">
                        <h3>4.8★</h3>
                        <p>Average Rating</p>
                    </div>
                    <div class="badge-item">
                        <h3>97%</h3>
                        <p>Recommend Us</p>
                    </div>
                    <div class="badge-item">
                        <h3>100%</h3>
                        <p>Authentic Products</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <%-include("../partials/user/userfooter")%>

            <!-- Size Selection Modal -->
            <div class="size-modal-overlay" id="sizeModalOverlay">
                <div class="size-modal" id="sizeModal">
                    <span class="size-modal-close" onclick="closeSizeModal()">&times;</span>
                    <h4>Select Size</h4>
                    <p class="product-name" id="modalProductName"></p>
                    <div class="size-options" id="sizeOptions">
                        <!-- Size options will be injected here -->
                    </div>
                </div>
            </div>

            <script>
                // Enhanced Add to Cart functionality
                async function addToCartWithSize(productId, size) {
                    try {
                        const response = await fetch('/cart/add', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                "Accept": "application/json"
                            },
                            body: JSON.stringify({
                                productId: productId,
                                size: size, // Always pass the selected size
                                quantity: 1
                            })
                        });

                        const data = await response.json();

                        if (data.success) {
                            updateCartCount(data.cartCount);
                            showNotification('Product added to cart successfully!');
                            closeSizeModal();
                        } else {
                            if (data.message === "Please login to continue") {
                                window.location.href = '/login';
                            }
                            showNotification(data.message || 'Error adding product to cart');
                        }
                    } catch (error) {
                        console.error('Error adding to cart:', error);
                        showNotification('Error adding product to cart. Please try again.');
                    }
                }

                // New functions for size modal
                function openSizeModal(buttonElement, productId) {
                    const productCard = buttonElement.closest('.product-card');
                    const variantsData = productCard.getAttribute('data-variants');
                    const productName = productCard.querySelector('.product-name').textContent.trim();

                    const variants = JSON.parse(variantsData);

                    const sizeOptionsContainer = document.getElementById('sizeOptions');
                    sizeOptionsContainer.innerHTML = ''; // Clear previous options

                    const availableVariants = variants.filter(v => v.variantQuantity > 0);

                    if (availableVariants.length === 0) {
                        showNotification('This product is currently out of stock.', 'error');
                        return;
                    }

                    if (availableVariants.length === 1) {
                        // If only one size is available, add it directly to the cart
                        addToCartWithSize(productId, availableVariants[0].size);
                        return;
                    }

                    document.getElementById('modalProductName').textContent = productName;

                    availableVariants.forEach(variant => {
                        const sizeEl = document.createElement('div');
                        sizeEl.className = 'size-option';
                        sizeEl.innerHTML = `
                            <span class="size-label">${variant.size}</span>
                            <span class="size-price">₹${variant.salePrice.toLocaleString('en-IN')}</span>
                        `;
                        sizeEl.onclick = () => addToCartWithSize(productId, variant.size);
                        sizeOptionsContainer.appendChild(sizeEl);
                    });

                    const overlay = document.getElementById('sizeModalOverlay');
                    overlay.style.display = 'flex';
                    setTimeout(() => overlay.classList.add('show'), 10); // For transition
                }

                function closeSizeModal() {
                    const overlay = document.getElementById('sizeModalOverlay');
                    overlay.classList.remove('show');
                    setTimeout(() => {
                        overlay.style.display = 'none';
                    }, 300); // Match transition duration
                }

                // Update cart count in navbar
                function updateCartCount(change) {
                    const cartCountElem = document.getElementById('cartCount');
                    if (cartCountElem) {
                        const currentCount = parseInt(cartCountElem.textContent) || 0;
                        const newCount = Math.max(0, change);
                        cartCountElem.textContent = newCount;

                        // Add animation to cart icon
                        const cartIcon = cartCountElem.closest('.cart-icon');
                        if (cartIcon) {
                            cartIcon.style.animation = 'cartBounce 0.5s ease';
                            setTimeout(() => {
                                cartIcon.style.animation = '';
                            }, 500);
                        }
                    }
                }

                // Enhanced wishlist functionality
                async function toggleWishlist(productId, element) {
                    const heartIcon = element.querySelector('i');
                    const isInWishlist = heartIcon.classList.contains('fas');

                    try {
                        const response = await fetch('/wishlist/toggle', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                "Accept": "application/json"
                            },
                            body: JSON.stringify({ productId: productId })
                        });

                        const data = await response.json();

                        if (data.success) {
                            if (data.action === 'added') {
                                heartIcon.classList.remove('far');
                                heartIcon.classList.add('fas');
                                heartIcon.style.color = '#ff4757';
                                updateWishlistCount(1)
                                showNotification('Added to wishlist!');
                            } else if (data.action === 'removed') {
                                heartIcon.classList.remove('fas');
                                heartIcon.classList.add('far');
                                heartIcon.style.color = '';
                                updateWishlistCount(-1)
                                showNotification('Removed from wishlist!');
                            }
                        } else {
                            if (data.message === "Please login to continue") {
                                window.location.href = '/login'
                            }
                            showNotification(data.message || 'Error updating wishlist');
                        }
                    } catch (error) {
                        console.error('Error toggling wishlist:', error.message);
                        showNotification('Error updating wishlist. Please try again.');
                    }
                }

                function updateWishlistCount(change) {
                    const wishlistCountElem = document.getElementById('wishlistCount');
                    if (wishlistCountElem) {
                        const currentCount = parseInt(wishlistCountElem.textContent) || 0;
                        const newCount = Math.max(0, currentCount + change);
                        wishlistCountElem.textContent = newCount;
                    }
                }

                function showNotification(message) {
                    const notification = document.createElement('div');
                    notification.className = 'notification';
                    notification.innerHTML = `
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            `;
                    document.body.appendChild(notification);

                    setTimeout(() => {
                        notification.style.animation = 'slideOut 0.3s ease forwards';
                        setTimeout(() => {
                            notification.remove();
                        }, 300);
                    }, 2700);
                }

                function redirectToLogin() {
                    window.location.href = '/login';
                    return false;
                }

                // Enhanced functionality for new design
                document.addEventListener('DOMContentLoaded', function () {
                    // All shop buttons functionality
                    const shopBtns = document.querySelectorAll('.shop-btn');
                    shopBtns.forEach(btn => {
                        btn.addEventListener('click', function () {
                    <% if (typeof user !== 'undefined' && user) { %>
                                window.location.href = '/shop';
                    <% } else { %>
                                redirectToLogin();
                    <% } %>
                });
                    });

                    // Color selector functionality
                    const colorDots = document.querySelectorAll('.color-dot');
                    colorDots.forEach(dot => {
                        dot.addEventListener('click', function () {
                            colorDots.forEach(d => d.classList.remove('active'));
                            this.classList.add('active');
                        });
                    });

                    // Close modal when clicking on the overlay
                    document.getElementById('sizeModalOverlay').addEventListener('click', function(event) {
                        if (event.target === this) {
                            closeSizeModal();
                        }
                    });
                });
            </script>
</body>

</html>