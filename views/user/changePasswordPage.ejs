<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Settings</title>
    <link rel="stylesheet" href="/css/changePasswordPage.css">
</head>
<body>
    <!-- Navbar -->
     <%- include("../partials/user/navbar") %>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <div class="settings-header">
                <h1>Account Settings</h1>
                <p>Manage your email and password settings</p>
            </div>

            <div class="settings-grid">
                <!-- Email Change Section -->
                <div class="settings-card">
                    <div class="card-header">
                        <h3>Change Email Address</h3>
                        <p>Update your email address for account notifications</p>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label for="current-email">Current Email</label>
                            <input type="email" id="current-email" class="form-input" value="<%= user.email%>">
                        </div>
                        <div class="form-group">
                            <label for="new-email">New Email Address</label>
                            <input type="email" id="new-email" class="form-input" placeholder="Enter new email address">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="openEmailModal()">Change Email</button>
                    </div>
                </div>

                <!-- Password Change Section -->
                <div class="settings-card">
                    <div class="card-header">
                        <h3>Change Password</h3>
                        <p>Update your password to keep your account secure</p>
                    </div>
                    <div class="card-body">
                        <form id="password-form">
                            <div class="form-group">
                                <label for="current-password">Current Password</label>
                                <input type="password" id="current-password" class="form-input" placeholder="Enter current password" required>
                            </div>
                            <div class="form-group">
                                <label for="new-password">New Password</label>
                                <input type="password" id="new-password" class="form-input" placeholder="Enter new password" required>
                            </div>
                            <div class="form-group">
                                <label for="confirm-password">Confirm New Password</label>
                                <input type="password" id="confirm-password" class="form-input" placeholder="Confirm new password" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Update Password</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Email OTP Verification Modal -->
    <div id="email-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Verify Your New Email</h3>
                <span class="close" onclick="closeEmailModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p>We've sent a verification code to your new email address:</p>
                <p class="email-display" id="modal-email"></p>
                <div class="form-group">
                    <label for="otp-code">Enter Verification Code</label>
                    <input type="text" id="otp-code" class="form-input" placeholder="Enter 6-digit code" maxlength="6">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="resendOTP()">Resend Code</button>
                    <button type="button" class="btn btn-primary" onclick="verifyOTP()">Verify Email</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <%- include("../partials/user/userfooter") %>

    <script>
        // Email Modal Functions
        function openEmailModal() {
            const newEmail = document.getElementById('new-email').value;
            if (!newEmail) {
                alert('Please enter a new email address');
                return;
            }
            
            if (!isValidEmail(newEmail)) {
                alert('Please enter a valid email address');
                return;
            }
            
            document.getElementById('modal-email').textContent = newEmail;
            document.getElementById('email-modal').style.display = 'block';
        }

        function closeEmailModal() {
            document.getElementById('email-modal').style.display = 'none';
            document.getElementById('otp-code').value = '';
        }

        function resendOTP() {
            alert('Verification code has been resent to your email');
        }

        function verifyOTP() {
            const otpCode = document.getElementById('otp-code').value;
            if (!otpCode || otpCode.length !== 6) {
                alert('Please enter a valid 6-digit verification code');
                return;
            }
            
            // Simulate OTP verification
            alert('Email successfully updated!');
            closeEmailModal();
            document.getElementById('current-email').value = document.getElementById('new-email').value;
            document.getElementById('new-email').value = '';
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        // Password Form Handling
        document.getElementById('password-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-password').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('Please fill in all password fields');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match');
                return;
            }
            
            if (newPassword.length < 8) {
                alert('Password must be at least 8 characters long');
                return;
            }
            
            // Simulate password update
            alert('Password successfully updated!');
            this.reset();
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('email-modal');
            if (event.target === modal) {
                closeEmailModal();
            }
        }
    </script>
</body>
</html>